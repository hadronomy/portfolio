---
import '~/styles/global.css';

import ExperienceTimeline from '~/components/ExperienceTimeline.astro';
import Hero from '~/components/HomeHero.astro';
import ProjectGrid from '~/components/ProjectGrid.astro';
import SkillGrid from '~/components/SkillGrid.astro';
import MainLayout from '~/layouts/Main.astro';

import { GITHUB_TOKEN } from "astro:env/server";
import { GrassView } from '~/components/react/grass';
import { InteractiveBadge } from '~/components/react/interactive-badge';

// Define the skills array
const skills = [
  { name: 'TypeScript', icon: 'logos:typescript-icon' },
  { name: 'JavaScript', icon: 'logos:javascript' },
  { name: 'React', icon: 'logos:react' },
  { name: 'Rust', icon: 'material-icon-theme:rust' },
  { name: 'Python', icon: 'logos:python' },
  { name: 'C++', icon: 'logos:c-plusplus' },
  { name: 'HTML', icon: 'vscode-icons:file-type-html' },
  { name: 'CSS', icon: 'vscode-icons:file-type-css' },
  { name: 'Node.js', icon: 'logos:nodejs-icon' },
  { name: 'Next.js', icon: 'logos:nextjs-icon' },
  { name: 'Astro', icon: 'simple-icons:astro' },
  { name: 'Tailwind CSS', icon: 'logos:tailwindcss-icon' },
  { name: 'Docker', icon: 'logos:docker-icon' },
  { name: 'PostgreSQL', icon: 'logos:postgresql' },
  { name: 'Git', icon: 'logos:git-icon' },
  { name: 'Linux', icon: 'logos:linux-tux' },
  { name: 'Kubernetes', icon: 'logos:kubernetes' },
  { name: 'Go', icon: 'logos:go' },
  { name: 'Zig', icon: 'material-icon-theme:zig' },
  { name: 'WebAssembly', icon: 'logos:webassembly' },
  { name: 'Prisma', icon: 'logos:prisma' },
  { name: 'Vite', icon: 'logos:vitejs' },
  { name: 'Three.js', icon: 'logos:threejs' },
  { name: 'Tauri', icon: 'logos:tauri' }
];

// Define experience data
const experiences = [
  {
    title: 'Computer Science Student',
    organization: 'Universidad de La Laguna',
    period: '2021 - 2025',
    description: 'Studied advanced algorithms, software architecture, and full-stack development. Participated in coding competitions and led student projects.',
    tags: ['Algorithms', 'Software Design', 'Full-stack']
  },
  {
    title: 'Self-Taught Programmer',
    organization: 'Self',
    period: '2014 - Present',
    description: 'Over 10 years of continuous learning across all fields of programming. From web development to systems programming, exploring various languages, frameworks, and paradigms through personal projects and open-source contributions.',
    tags: ['Full-stack', 'Systems Programming', 'Open Source', 'Multi-paradigm']
  },
];

// Fetch GitHub projects data
const username = 'hadronomy';
let projects = [];
try {
  const response = await fetch(
    `https://api.github.com/users/${username}/repos?sort=updated&per_page=6`, 
    { headers: { Authorization: `Bearer ${GITHUB_TOKEN}` } },
  );
  if(response.ok) {
    projects = await response.json();
  }
} catch(e) {
  console.error("Failed to fetch github repos", e);
}
---

<MainLayout>
  <!-- Hero Section -->
  <Hero id="hero" />

  <!-- Skills -->
  <div id="skills" class="scroll-mt-24 border-b border-white/20">
    <div class="p-8 bg-white/5 border-b border-white/20">
      <div class="flex items-center gap-4">
        <span class="text-4xl font-mono font-bold text-white/10">01</span>
        <h2 class="text-xl font-bold uppercase tracking-widest">Technical Proficiency</h2>
      </div>
    </div>
    <SkillGrid skills={skills} />
  </div>

  <!-- Projects -->
  <div id="projects" class="scroll-mt-24 border-b border-white/20">
    <div class="p-8 bg-white/5 border-b border-white/20">
      <div class="flex items-center gap-4">
        <span class="text-4xl font-mono font-bold text-white/10">02</span>
        <h2 class="text-xl font-bold uppercase tracking-widest">Selected Works</h2>
      </div>
    </div>
    <ProjectGrid projects={projects} />
  </div>

  <!-- Experience -->
  <div id="experience" class="scroll-mt-24 border-b border-white/20">
    <div class="p-8 bg-white/5 border-b border-white/20">
      <div class="flex items-center gap-4">
        <span class="text-4xl font-mono font-bold text-white/10">03</span>
        <h2 class="text-xl font-bold uppercase tracking-widest">Career History</h2>
      </div>
    </div>
    <ExperienceTimeline items={experiences} />
  </div>

  <!-- Contact / Playground Section -->
  <section id="contact" class="scroll-mt-24 flex flex-col w-full border-b border-white/20">
      
      <!-- 1. The Access Card (Physics Simulation) -->
      <div class="relative w-full h-[500px] bg-[#050505] border-b border-white/20 overflow-hidden group">
        
        <!-- Background Grid -->
        <div class="absolute inset-0 bg-[linear-gradient(to_right,#ffffff03_1px,transparent_1px),linear-gradient(to_bottom,#ffffff03_1px,transparent_1px)] bg-[size:40px_40px] pointer-events-none"></div>

        <!-- Header Overlay -->
        <div class="absolute top-0 left-0 w-full p-6 flex justify-between items-start z-10 pointer-events-none">
           <div class="flex flex-col gap-1">
              <span class="font-mono text-xs text-white/40 uppercase tracking-widest">Security Checkpoint</span>
              <h3 class="text-xl font-bold uppercase tracking-tight">Visitor Access</h3>
           </div>
           <div class="px-3 py-1 border border-white/10 bg-white/5 text-[10px] font-mono uppercase text-green-500 animate-pulse">
              Physics_Engine: Active
           </div>
        </div>

        <!-- Center: Interaction Prompt -->
        <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-10 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-500">
           <span class="font-mono text-[10px] text-white/40 uppercase tracking-[0.2em] bg-black/50 px-4 py-2 border border-white/10 rounded-full backdrop-blur-md">
              [ Drag to Interact ]
           </span>
        </div>

        <!-- The 3D Scene -->
        <div class="w-full h-full cursor-grab active:cursor-grabbing">
           <InteractiveBadge client:visible />
        </div>
      </div>

      <!-- 2. Terrain (Touch Grass Reference) -->
      <div class="relative w-full h-[600px] bg-black overflow-hidden group">
        
        <!-- Header Overlay -->
        <div class="absolute top-6 left-6 z-10 pointer-events-none">
           <div class="inline-flex items-center gap-2 px-3 py-1 border border-white/20 bg-black/40 backdrop-blur-md">
             <div class="w-2 h-2 bg-green-500 rounded-full"></div>
             <span class="font-mono text-xs uppercase tracking-widest">Environment_Render</span>
           </div>
        </div>

        <!-- "Touch Grass" Call to Action Overlay -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 text-center pointer-events-none mix-blend-difference">
           <p class="font-mono text-xs md:text-sm text-white/60 mb-2 tracking-[0.2em] uppercase">System Overheated?</p>
           <h2 class="text-5xl md:text-7xl font-black text-white tracking-tighter uppercase leading-none opacity-20 group-hover:opacity-100 transition-opacity duration-700">
              Go Touch<br/>Grass
           </h2>
        </div>

        <!-- The 3D Grass Scene -->
        <div class="w-full h-full">
           <GrassView client:visible />
        </div>
        
        <!-- Bottom Contact Footer Overlay -->
        <div class="absolute bottom-0 left-0 w-full p-8 md:p-12 bg-gradient-to-t from-black via-black/80 to-transparent z-10 flex flex-col md:flex-row justify-between items-end gap-6">
          <div class="max-w-md">
            <h3 class="text-2xl font-bold mb-2">Ready to collaborate?</h3>
            <p class="text-muted-foreground font-mono text-sm leading-relaxed">
              Initiate communication protocol. Available for freelance projects and full-time opportunities.
            </p>
          </div>
          
          <div class="flex flex-col items-end">
             <span class="font-mono text-[10px] text-white/40 uppercase tracking-widest mb-1">Email Transmission</span>
             <a href="mailto:hadronomy@gmail.com" class="text-xl md:text-3xl font-mono text-white hover:text-green-400 transition-colors border-b border-transparent hover:border-green-400 pb-1">
               hadronomy@gmail.com
             </a>
          </div>
        </div>
      </div>
  </section>
</MainLayout>