@import 'tailwindcss';
@import 'fumadocs-ui/css/neutral.css';
@import 'fumadocs-ui/css/preset.css';

@config '../../tailwind.config.ts';

@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--border);
  }
}

@layer base {
  :root {
    /* Force Dark Mode Default */
    --background-image: url('/noise.png');
    --background: 0 0% 5%;
    --foreground: 0 0% 95%;

    --muted: 0 0% 10%;
    --muted-foreground: 0 0% 60%;

    --popover: 0 0% 5%;
    --popover-foreground: 0 0% 95%;

    --card: 0 0% 5%;
    --card-foreground: 0 0% 95%;

    --border: 0 0% 20%;
    --input: 0 0% 20%;

    --primary: 0 0% 98%;
    --primary-foreground: 0 0% 5%;

    --secondary: 0 0% 15%;
    --secondary-foreground: 0 0% 98%;

    --accent: 0 0% 20%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 63% 31%;
    --destructive-foreground: 0 0% 98%;

    --ring: 0 0% 80%;

    --radius: 0px;

    --font-sans: 'Maple Mono', 'Onest Variable', sans-serif;
    --font-mono: 'Maple Mono', monospace;

    --halftone: rgba(255, 255, 255, 0.1);

    color-scheme: dark;

    --animate-sparkle: sparkle 700ms forwards;
  }

  /* Force Dark styling regardless of preference for this specific aesthetic */
  .dark {
    --background-image: url('/noise.png');
    --background: 0 0% 5%;
    --foreground: 0 0% 95%;
    --muted: 0 0% 10%;
    --muted-foreground: 0 0% 60%;
    --border: 0 0% 20%;
    --halftone: rgba(20, 20, 20, 0.8);
  }
}

@layer base {
  * {
    @apply border-border box-border;
  }

  body {
    @apply bg-background text-foreground font-mono antialiased overflow-x-hidden;
    /* Diagonal Stripe Pattern */
    background-image: linear-gradient(
      45deg, 
      rgba(255, 255, 255, 0.03) 25%, 
      transparent 25%, 
      transparent 50%, 
      rgba(255, 255, 255, 0.03) 50%, 
      rgba(255, 255, 255, 0.03) 75%, 
      transparent 75%, 
      transparent
    );
    background-size: 4px 4px;
  }

  /* 
     SCROLLBAR STYLING 
  */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
    background: transparent;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 4px;
    border: 2px solid transparent; /* Creates padding around the thumb */
    background-clip: content-box;
  }

  ::-webkit-scrollbar-thumb:hover {
    background-color: #666;
  }

  /* Brutalist Utilities */
  .neo-border-r {
    border-right: 1px solid var(--border);
  }
  
  .neo-border-b {
    border-bottom: 1px solid var(--border);
  }

  .neo-border-l {
    border-left: 1px solid var(--border);
  }

  .neo-border-t {
    border-top: 1px solid var(--border);
  }

  h1, h2, h3, h4, h5, h6 {
    @apply font-mono uppercase tracking-wider font-bold;
  }

  /* 
    CODE BLOCK FIXES 
    - Using flex-col instead of grid prevents ghost rows from newlines.
    - min-width: 0 prevents flex child overflow issues.
  */
  pre code {
    @apply flex! flex-col! text-[14px]! font-medium! font-mono! p-0! m-0! min-w-0!;
    font-variant-ligatures: additional-ligatures !important;
    line-height: 1.6 !important;
  }

  code:not(pre code):not(pre * code) {
    @apply rounded-lg! border-2! p-0.25! m-0! bg-muted! text-foreground/100!;
  }

  /* LIST STYLING FIXES */

  /* Target lists inside .prose specifically to override defaults */
  .prose ul,
  .prose ol {
    margin: 0.75rem 0;
    padding: 0 !important; /* Remove prose padding */
    list-style: none !important; /* Kill default markers */
    --indent-col: 1.5rem;   
    --indent-step: 1.25rem; 
    --gap: 0.5rem;          
    color: inherit;
  }

  /* Small top margin before any nested list */
  .prose li > ul,
  .prose li > ol {
    margin-top: 0.35rem;
  }

  /* -------- Level 1 (Top Level) -------- */
  .prose > ul > li,
  .prose > ol > li {
    display: grid; /* This removes the default ::marker behavior */
    grid-template-columns: var(--indent-col) 1fr;
    gap: 0.5rem;
    align-items: start;
  }
  
  .prose > ul > li + li,
  .prose > ol > li + li {
    margin-top: var(--gap);
  }

  /* -------- Level 2 -------- */
  .prose ul ul > li,
  .prose ul ol > li,
  .prose ol ul > li,
  .prose ol ol > li {
    display: grid;
    grid-template-columns: calc(var(--indent-col) + var(--indent-step)) 1fr;
    gap: 0.5rem;
    align-items: start;
  }
  .prose ul ul > li + li,
  .prose ul ol > li + li,
  .prose ol ul > li + li,
  .prose ol ol > li + li {
    margin-top: var(--gap);
  }

  /* -------- Level 3 -------- */
  .prose ul ul ul > li,
  .prose ul ul ol > li,
  .prose ol ul ul > li,
  .prose ol ol ul > li {
    display: grid;
    grid-template-columns: calc(var(--indent-col) + 2 * var(--indent-step)) 1fr;
    gap: 0.5rem;
    align-items: start;
  }
  .prose ul ul ul > li + li,
  .prose ul ul ol > li + li,
  .prose ol ul ul > li + li,
  .prose ol ol ul > li + li {
    margin-top: var(--gap);
  }

  /* -------- Level 4 -------- */
  .prose ul ul ul ul > li,
  .prose ul ul ul ol > li,
  .prose ol ul ul ul > li,
  .prose ol ol ul ul > li {
    display: grid;
    grid-template-columns: calc(var(--indent-col) + 3 * var(--indent-step)) 1fr;
    gap: 0.5rem;
    align-items: start;
  }
  .prose ul ul ul ul > li + li,
  .prose ul ul ul ol > li + li,
  .prose ol ul ul ul > li + li,
  .prose ol ol ul ul > li + li {
    margin-top: var(--gap);
  }

  /* -------- Markers -------- */

  /* UL marker: custom symbol */
  .prose ul > li::before {
    content: "->";
    color: #6b7280;
    line-height: 1.2;
    translate: 0 0.15em;
    justify-self: end; /* right-align in marker column */
  }

  /* OL markers: hierarchical numbers using CSS counters */
  .prose ol {
    counter-reset: item;
  }
  .prose ol > li {
    counter-increment: item;
  }
  .prose ol > li::before {
    content: counters(item, ".") ".";
    color: #6b7280;
    line-height: 1.2;
    translate: 0 0.15em;
    justify-self: end;
    text-align: right;
    font-variant-numeric: tabular-nums;
  }

  /* Alternate UL markers per depth */
  .prose ul ul > li::before {
    content: "•";
  }
  .prose ul ul ul > li::before {
    content: "–";
  }

  /* Tighten text line-height slightly for nested items */
  .prose ul ul > li,
  .prose ol ul > li,
  .prose ul ol > li,
  .prose ol ol > li {
    line-height: 1.45;
  }

  article {
    @apply break-words;
  }

  /* 
    KBD STYLING 
    "Mechanical Key" Look - Fixed Layout Shift
  */
  
  kbd {
    box-sizing: border-box;
    font-family: var(--font-mono);
  }

  /* Wrapper Container (e.g. CTRL + C) */
  kbd:has(kbd) {
    display: inline-flex !important;
    align-items: center !important;
    gap: 0.35em !important;
    
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    padding: 0 !important;
    margin: 0 !important;
    
    color: var(--muted-foreground) !important;
    font-weight: normal !important;
    font-size: 0.9em !important;
    vertical-align: baseline !important;
  }

  /* The actual Key Cap */
  kbd:not(:has(kbd)) {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    
    background: linear-gradient(180deg, #333 0%, #222 100%);
    border: 1px solid #555;
    
    /* The 3D Depth */
    border-bottom: 3px solid #111; 
    border-radius: 4px;
    
    color: #fff;
    text-shadow: 0 1px 1px rgba(0,0,0,0.8);
    font-family: var(--font-mono);
    font-size: 0.75em;
    font-weight: 700;
    line-height: 1;
    
    min-width: 24px;
    height: 26px;
    padding: 0 6px;
    margin: 0 2px;
    
    box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    
    /* Default state */
    transform: translateY(0); 
    transition: all 0.1s ease;
  }

  /* Key Press Effect - No Reflow */
  kbd:not(:has(kbd)):active {
    /* 
       Instead of changing border-width (which causes reflow),
       we make the border transparent and translate the element down.
    */
    border-bottom-color: transparent; 
    transform: translateY(3px); /* Move down by the depth amount */
    
    box-shadow: none;
    background: #111;
  }

  /* 
     MARK / HIGHLIGHT STYLING 
     Cyber-Green Theme
  */
  mark {
    background-color: rgba(34, 197, 94, 0.15);
    color: #4ade80; /* bright green */
    
    border-bottom: 1px solid rgba(34, 197, 94, 0.5);
    border-radius: 2px;
    padding: 0 2px;
    
    font-weight: bold;
    text-shadow: 0 0 10px rgba(74, 222, 128, 0.4);
    box-shadow: 0 0 15px rgba(34, 197, 94, 0.05);
  }

  /* Line Numbers */
  code[data-line-numbers] {
    counter-reset: line;
  }

  code[data-line-numbers] > [data-line]::before {
    counter-increment: line;
    content: counter(line);
    display: inline-block;
    width: 0.75rem;
    margin-right: 2rem;
    text-align: right;
    color: var(--muted-foreground);
    opacity: 40%;
  }

  code[data-line-numbers-max-digits='2'] > [data-line]::before {
    width: 1.25rem;
  }

  code[data-line-numbers-max-digits='3'] > [data-line]::before {
    width: 1.75rem;
  }

  code[data-line-numbers-max-digits='4'] > [data-line]::before {
    width: 2.25rem;
  }

  /* Shiki themes */
  html.dark .shiki,
  html.dark .shiki span {
    color: var(--shiki-dark) !important;
    font-style: var(--shiki-dark-font-style) !important;
    font-weight: var(--shiki-dark-font-weight) !important;
    text-decoration: var(--shiki-dark-text-decoration) !important;
  }

  /* Halftone */
  .bg-halftone {
    --bg-size: 0.3rem;
    --bg-position: calc(var(--bgSize) / 2);
    --stop1: 3%;
    --stop2: 65%;
  }

  .bg-halftone::before {
    content: '';
    position: absolute;
    inset: 0;

    background-color: transparent;
    background-image: radial-gradient(
        circle at center,
        transparent var(--stop1),
        var(--halftone) var(--stop2)
      ),
      radial-gradient(circle at center, transparent var(--stop1), var(--halftone) var(--stop2));
    background-position:
      0 0,
      var(--bg-position) var(--bg-position);
    background-repeat: round;
    background-size: var(--bg-size) var(--bg-size);
    backdrop-filter: blur(3px);
    mask: linear-gradient(rgb(0, 0, 0) 40%, rgba(0, 0, 0, 0) 100%);
  }
}

@keyframes sparkle {
  0% {
    transform: scale(0) rotate(0deg);
  }
  50% {
    transform: scale(1) rotate(90deg);
  }
  100% {
    transform: scale(0) rotate(180deg);
  }
}

@utility animate-sparkle {
  animation: var(--animate-sparkle);
}